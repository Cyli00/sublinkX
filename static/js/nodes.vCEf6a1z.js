import{d as e,o as a,r as l,C as t,c as o,e as u,$ as n,w as r,a5 as i,a6 as s,a7 as d,m,a4 as c,O as v,P as p,l as f,aB as y,aK as _}from"./index.B5EkDzSe.js";import{E as h}from"./el-card.C8hzq6sH.js";import{E as g,a as w}from"./el-table-column.CGcV1kd3.js";import"./el-tooltip.l0sNRNKZ.js";import"./el-popper.5vJ0nHTn.js";import"./el-scrollbar.D_FsbYB4.js";import"./el-tag.C-RZJJr8.js";import{E as k,a as j}from"./el-tabs.DseLWI48.js";import"./el-tab-pane.l0sNRNKZ.js";import{E as V,a as b}from"./el-col.a9_Xhzrb.js";import{g as C,G as x,a as N,A as E,S as T,D as A}from"./node.n-3-ZNyW.js";import{a as L,E as U}from"./el-select.BsCGtog6.js";import{E as G}from"./el-dialog.Bqk7yTN4.js";import"./_initCloneObject.B9uKNKbL.js";import"./debounce.Bk_438JU.js";import"./isEqual.BbyV2Fto.js";import"./index.D82FeHVY.js";import"./index.w3DC5PVV.js";import"./index.3DrrgpJ_.js";import"./strings.CCWhLXdk.js";import"./castArray.C8zluFKn.js";import"./use-dialog.D2sHIKoK.js";import"./refs.D8PQuTkx.js";const B={key:2},D=e({__name:"nodes",setup(e){a((async()=>{X(),Y()}));const D=l([]);l({});const z=l(""),I=l(""),O=l([]),R=l([]),S=l("全部"),$=l(!1),F=l(!1),J=l({Title:"",Name:"",Link:"",GroupName:[]}),K=l([]),P=l([]),q=l(!1),Q=l([]),W=l(""),H=l("1");function M(){W.value="",z.value="",I.value="",Q.value=[],q.value=!1,$.value=!1,F.value=!1}async function X(){const{data:e}=await C();e.length>0&&(R.value=O.value=e),e.forEach((e=>{P.value.push(e.Name)}))}async function Y(){const{data:e}=await x();Array.isArray(e)&&e.length>0&&(K.value=e),H.value=K.value.length>0?"1":"2"}a((()=>{}));const Z=()=>{$.value=!0,J.value={Title:"添加节点",Name:"",Link:"",GroupName:[]},K.value.length>0&&(q.value=!0)},ee=()=>{F.value=!0,J.value={Title:"绑定分组",Name:"",Link:""}},ae=async()=>{let e=z.value.trim().split(/[\n,]/);if(e=e.map((e=>e.trim())).filter((e=>""!==e)),""!==z.value.trim()){try{for(const a of e)if(a){const e={link:a.trim(),group:Q.value.join(",")};await E(e).then((()=>{y.success("节点添加成功"),$.value=!1}))}}catch(a){}X(),Y(),M()}else y.warning("节点链接不能为空")},le=async()=>{try{if("1"===H.value&&0===Q.value.length)return void y.warning("你还没有选择分组");if("2"===H.value&&""===I.value.trim())return void y.warning("创建的分组名不能为空");if(W.value.length>0){const e={name:W.value,group:"1"==H.value?Q.value.join(","):I.value};await T(e).then((()=>{y.success("分组绑定成功")}))}}catch(e){}X(),Y(),M()},te=e=>(e.CreatedAt=new Date(e.CreatedAt).toLocaleString(),e.CreatedAt),oe=()=>{const e=P.value.find((e=>e===W.value));Q.value=[],O.value.forEach((a=>{var l,t;a.Name===e&&((null==(l=a.GroupNodes)?void 0:l.length)??0)>0&&(null==(t=a.GroupNodes)||t.forEach((e=>{Q.value.push(e.Name)})))}))},ue=(e,a)=>{const l=e.GroupNodes||[];return Array.isArray(l)&&0!==l.length?l.map((e=>e.Name)).join(", "):"未分组"},ne=e=>{if(navigator.clipboard)navigator.clipboard.writeText(e).then((()=>{y.success("链接已复制到剪贴板！")})).catch((e=>{y.error("复制失败！请手动复制。")}));else{const l=document.createElement("textarea");l.value=e,document.body.appendChild(l),l.select();try{document.execCommand("copy"),y.success("链接已复制到剪贴板！")}catch(a){y.warning("复制失败！")}finally{document.body.removeChild(l)}}},re=async()=>{if(0!==O.value.length)try{await _.confirm(`你是否要删除选中的 ${O.value.length} 条节点 ?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});for(const e of O.value)await A({id:e.ID});y.success("批量删除成功"),await X(),O.value=[]}catch(e){"cancel"!==e&&y.error("批量删除失败！")}else y.warning("请选择要删除的节点！")},ie=async()=>{if(0!==D.value.length)try{ne(D.value.map((e=>e.Link)).join("\n"))}catch(e){"cancel"!==e&&y.error("批量复制失败")}else y.warning("请选择要复制的节点！")},se=e=>{D.value=e};return t(S,(e=>{O.value="全部"===e?R.value:R.value.filter((a=>{var l;return null==(l=a.GroupNodes)?void 0:l.some((a=>a.Name===e))}))})),(e,a)=>{const l=i,t=s,C=G,x=U,E=L,T=N,D=b,R=V,q=j,M=k,Y=w,de=g,me=h;return u(),o("div",null,[n(C,{modelValue:$.value,"onUpdate:modelValue":a[2]||(a[2]=e=>$.value=e),title:J.value.Title,width:"80%"},{default:r((()=>[n(l,{modelValue:z.value,"onUpdate:modelValue":a[0]||(a[0]=e=>z.value=e),placeholder:"请输入节点多行使用回车或逗号分开,支持base64格式的url订阅",type:"textarea",style:{"margin-bottom":"10px"},autosize:{minRows:2,maxRows:10}},null,8,["modelValue"]),n(t,{type:"primary",onClick:ae},{default:r((()=>a[11]||(a[11]=[d("添加")]))),_:1,__:[11]}),n(t,{onClick:a[1]||(a[1]=e=>$.value=!1)},{default:r((()=>a[12]||(a[12]=[d("取消")]))),_:1,__:[12]})])),_:1},8,["modelValue","title"]),n(C,{modelValue:F.value,"onUpdate:modelValue":a[9]||(a[9]=e=>F.value=e),title:J.value.Title,width:"80%"},{default:r((()=>[P.value.length>0?(u(),m(E,{key:0,modelValue:W.value,"onUpdate:modelValue":a[3]||(a[3]=e=>W.value=e),placeholder:"选择已有节点",class:"default",onChange:oe},{default:r((()=>[(u(!0),o(v,null,p(P.value,(e=>(u(),m(x,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):c("",!0),K.value.length>0?(u(),m(T,{key:1,modelValue:H.value,"onUpdate:modelValue":a[4]||(a[4]=e=>H.value=e),label:"1"},{default:r((()=>a[13]||(a[13]=[d("选择已有分组")]))),_:1,__:[13]},8,["modelValue"])):c("",!0),n(T,{modelValue:H.value,"onUpdate:modelValue":a[5]||(a[5]=e=>H.value=e),label:"2"},{default:r((()=>a[14]||(a[14]=[d("创建并绑定分组")]))),_:1,__:[14]},8,["modelValue"]),K.value.length>0&&"1"==H.value?(u(),o("div",B,[n(E,{modelValue:Q.value,"onUpdate:modelValue":a[6]||(a[6]=e=>Q.value=e),multiple:"",placeholder:"选择已有分组",class:"default"},{default:r((()=>[(u(!0),o(v,null,p(K.value,(e=>(u(),m(x,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])):c("",!0),"2"==H.value?(u(),m(R,{key:3},{default:r((()=>[n(D,{span:12},{default:r((()=>[n(l,{modelValue:I.value,"onUpdate:modelValue":a[7]||(a[7]=e=>I.value=e),placeholder:"输入要创建的分组名",class:"default"},null,8,["modelValue"])])),_:1})])),_:1})):c("",!0),n(t,{type:"primary",onClick:le},{default:r((()=>a[15]||(a[15]=[d("绑定或创建分组")]))),_:1,__:[15]}),n(t,{onClick:a[8]||(a[8]=e=>F.value=!1)},{default:r((()=>a[16]||(a[16]=[d("取消")]))),_:1,__:[16]})])),_:1},8,["modelValue","title"]),n(me,null,{default:r((()=>[n(M,{modelValue:S.value,"onUpdate:modelValue":a[10]||(a[10]=e=>S.value=e)},{default:r((()=>[n(q,{label:"全部",name:"全部"}),(u(!0),o(v,null,p(K.value,(e=>(u(),m(q,{label:e,name:e,key:e},null,8,["label","name"])))),128))])),_:1},8,["modelValue"]),n(t,{type:"primary",onClick:Z},{default:r((()=>a[17]||(a[17]=[d("添加节点")]))),_:1,__:[17]}),n(t,{type:"success",onClick:ee},{default:r((()=>a[18]||(a[18]=[d("绑定分组")]))),_:1,__:[18]}),a[23]||(a[23]=f("div",{style:{"margin-bottom":"10px"}},null,-1)),n(de,{data:O.value,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:se},{default:r((()=>[n(Y,{type:"selection"}),n(Y,{type:"index"}),n(Y,{prop:"Name",label:"节点名"}),n(Y,{prop:"Link",label:"链接","show-overflow-tooltip":""}),n(Y,{prop:"CreatedAt",label:"创建时间",formatter:te,"show-overflow-tooltip":""}),n(Y,{label:"所属分组",formatter:ue,"show-overflow-tooltip":""}),n(Y,{fixed:"right",label:"操作",width:"120"},{default:r((e=>[n(t,{link:"",type:"primary",size:"small",onClick:a=>{return l=e.row,void ne(l.Link);var l}},{default:r((()=>a[19]||(a[19]=[d("复制")]))),_:2,__:[19]},1032,["onClick"]),n(t,{link:"",type:"primary",size:"small",onClick:a=>(async e=>{try{await _.confirm(`你是否要删除 ${e.Name} ?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await A({id:e.ID}),y.success("删除成功"),await X()}catch(a){"cancel"!==a&&y.error("删除失败！")}})(e.row)},{default:r((()=>a[20]||(a[20]=[d("删除")]))),_:2,__:[20]},1032,["onClick"])])),_:1})])),_:1},8,["data"]),a[24]||(a[24]=f("div",{style:{"margin-top":"20px"}},null,-1)),n(t,{type:"primary",onClick:ie},{default:r((()=>a[21]||(a[21]=[d("批量复制")]))),_:1,__:[21]}),n(t,{type:"danger",onClick:re},{default:r((()=>a[22]||(a[22]=[d("批量删除")]))),_:1,__:[22]}),a[25]||(a[25]=f("div",{style:{"margin-top":"20px"}},null,-1))])),_:1,__:[23,24,25]})])}}});export{D as default};
