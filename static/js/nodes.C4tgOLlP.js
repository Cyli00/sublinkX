import{d as e,o as a,r as l,C as t,c as o,e as u,$ as n,w as i,m as r,a4 as s,a5 as d,a7 as m,O as c,P as p,a6 as v,t as f,l as y,aB as _,aK as k,a8 as w}from"./index.BQLDJCDE.js";import{E as g}from"./el-card.CTX5lC-5.js";import{E as h,a as b}from"./el-table-column.Bm4IobD1.js";import"./el-tooltip.l0sNRNKZ.js";import"./el-popper.CpH5HJMu.js";import"./el-scrollbar.PI2VZJ2b.js";import{E as V}from"./el-tag.X3ElC6JM.js";import{E as j,a as N}from"./el-tabs.D4jGQI_C.js";import"./el-tab-pane.l0sNRNKZ.js";import{E as x}from"./el-dialog.4Gr8TKyA.js";import{a as C,E as L}from"./el-select.D09r31B5.js";import{g as E,G as T,a as D,A,U as G,D as U}from"./node.CjAEeY-e.js";import"./_initCloneObject.C1ttGGcT.js";import"./debounce.7DwFOk0p.js";import"./isEqual.DADUiilY.js";import"./index.DQmdMWe2.js";import"./index.DNViV2ks.js";import"./index.CclK_oo-.js";import"./strings.Dv2nQ1TS.js";import"./use-dialog.BsWeMcUI.js";import"./refs.Cs1Biyat.js";import"./castArray.CrTKd7It.js";const I={key:4},z=e({__name:"nodes",setup(e){a((async()=>{Z(),ee()}));const z=l("add"),R=l([]),B=l(null);l({});const S=l(""),$=l([]),O=l([]),F=l("全部"),J=l(!1),K=l(!1),P=l({Title:"",Name:"",Link:"",GroupName:[]}),q=l([]),W=l([]),H=l(!1),M=l([]),Q=l(""),X=l("1");function Y(){Q.value="",P.value={Title:"",Name:"",Link:"",GroupName:[]},S.value="",M.value=[],H.value=!1,J.value=!1,K.value=!1}async function Z(){const{data:e}=await E();e.length>0&&(O.value=$.value=e),W.value=[],e.forEach((e=>{W.value.push(e.Name)}))}async function ee(){const{data:e}=await T();Array.isArray(e)&&e.length>0&&(q.value=e),X.value=q.value.length>0?"1":"2"}const ae=()=>{z.value="add",J.value=!0,P.value={Title:"添加节点",Name:"",Link:"",GroupName:[]},M.value=[],S.value=""},le=async e=>{const a="add"===z.value;let l=P.value.Link.trim().split(/[\n,]/).map((e=>e.trim())).filter((e=>e));if(a&&0===l.length)_.warning("节点链接不能为空");else{try{if(a){for(const e of l)await A({link:e,group:"1"===X.value?M.value.join(","):S.value});_.success("节点添加成功")}else await G({id:P.value.ID,name:P.value.Name,link:P.value.Link,group:"1"===X.value?M.value.join(","):S.value}),_.success("节点更新成功")}catch(t){_.error((a?"添加":"更新")+"失败")}Z(),ee(),Y()}},te=e=>(e.CreatedAt=new Date(e.CreatedAt).toLocaleString(),e.CreatedAt),oe=(e,a)=>{const l=e.GroupNodes||[];return Array.isArray(l)&&0!==l.length?l.map((e=>e.Name)).join(", "):"未分组"},ue=e=>{if(navigator.clipboard)navigator.clipboard.writeText(e).then((()=>{_.success("链接已复制到剪贴板！")})).catch((e=>{_.error("复制失败！请手动复制。")}));else{const l=document.createElement("textarea");l.value=e,document.body.appendChild(l),l.select();try{document.execCommand("copy"),_.success("链接已复制到剪贴板！")}catch(a){_.warning("复制失败！")}finally{document.body.removeChild(l)}}},ne=async()=>{if(0!==R.value.length){try{await k.confirm(`你是否要删除选中的 ${R.value.length} 条节点 ?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=[];for(const a of R.value)await U({id:a.ID}),e.push(a.ID);_.success("批量删除成功"),$.value=$.value.filter((a=>!e.includes(a.ID)))}catch(e){"cancel"!==e&&_.error("批量删除失败！")}await ee(),await Z()}else _.warning("请选择要删除的节点！")},ie=()=>{w((()=>{const e=B.value;e&&$.value.forEach((a=>{e.toggleRowSelection(a,!0)}))}))},re=()=>{w((()=>{const e=B.value;e&&e.clearSelection()}))},se=async()=>{if(0!==R.value.length)try{ue(R.value.map((e=>e.Link)).join("\n"))}catch(e){"cancel"!==e&&_.error("批量复制失败")}else _.warning("请选择要复制的节点！")},de=e=>{R.value=e};return t(F,(e=>{$.value="全部"===e?O.value:O.value.filter((a=>{var l;return null==(l=a.GroupNodes)?void 0:l.some((a=>a.Name===e))}))})),(e,a)=>{const l=d,t=D,w=L,E=C,T=v,A=x,G=N,R=j,O=b,K=V,H=h,me=g;return u(),o("div",null,[n(A,{modelValue:J.value,"onUpdate:modelValue":a[8]||(a[8]=e=>J.value=e),title:P.value.Title,width:"80%"},{default:i((()=>["add"===z.value?(u(),r(l,{key:0,modelValue:P.value.Link,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value.Link=e),placeholder:"请输入节点链接，支持多行使用回车或逗号分开",type:"textarea",style:{"margin-bottom":"10px"},autosize:{minRows:2,maxRows:10}},null,8,["modelValue"])):s("",!0),"edit"===z.value?(u(),r(l,{key:1,modelValue:P.value.Name,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value.Name=e),placeholder:"节点名称（编辑时）",style:{"margin-bottom":"10px"}},null,8,["modelValue"])):s("",!0),"edit"===z.value?(u(),r(l,{key:2,modelValue:P.value.Link,"onUpdate:modelValue":a[2]||(a[2]=e=>P.value.Link=e),placeholder:"请输入节点链接，支持多行使用回车或逗号分开",type:"textarea",style:{"margin-bottom":"10px"},autosize:{minRows:2,maxRows:10}},null,8,["modelValue"])):s("",!0),q.value.length>0?(u(),r(t,{key:3,modelValue:X.value,"onUpdate:modelValue":a[3]||(a[3]=e=>X.value=e),label:"1"},{default:i((()=>a[10]||(a[10]=[m("选择已有分组")]))),_:1,__:[10]},8,["modelValue"])):s("",!0),n(t,{modelValue:X.value,"onUpdate:modelValue":a[4]||(a[4]=e=>X.value=e),label:"2"},{default:i((()=>a[11]||(a[11]=[m("创建新分组")]))),_:1,__:[11]},8,["modelValue"]),"1"===X.value&&q.value.length>0?(u(),o("div",I,[n(E,{modelValue:M.value,"onUpdate:modelValue":a[5]||(a[5]=e=>M.value=e),multiple:"",placeholder:"选择已有分组",class:"default"},{default:i((()=>[(u(!0),o(c,null,p(q.value,(e=>(u(),r(w,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])):s("",!0),"2"===X.value?(u(),r(l,{key:5,modelValue:S.value,"onUpdate:modelValue":a[6]||(a[6]=e=>S.value=e),placeholder:"输入要创建的分组名",class:"default"},null,8,["modelValue"])):s("",!0),n(T,{type:"primary",onClick:le},{default:i((()=>[m(f("add"===z.value?"添加":"更新"),1)])),_:1}),n(T,{onClick:a[7]||(a[7]=e=>J.value=!1)},{default:i((()=>a[12]||(a[12]=[m("取消")]))),_:1,__:[12]})])),_:1},8,["modelValue","title"]),n(me,null,{default:i((()=>[n(R,{modelValue:F.value,"onUpdate:modelValue":a[9]||(a[9]=e=>F.value=e)},{default:i((()=>[n(G,{label:`全部(${W.value.length})`,name:"全部"},null,8,["label"]),(u(!0),o(c,null,p(q.value,(e=>(u(),r(G,{label:e,name:e,key:e},null,8,["label","name"])))),128))])),_:1},8,["modelValue"]),n(T,{type:"primary",onClick:ae},{default:i((()=>a[13]||(a[13]=[m("添加节点")]))),_:1,__:[13]}),a[21]||(a[21]=y("div",{style:{"margin-bottom":"10px"}},null,-1)),n(H,{ref_key:"multipleTable",ref:B,data:$.value,"tooltip-effect":"dark",stripe:"",style:{width:"100%"},"row-key":"ID","tree-props":{children:"Nodes"},onSelectionChange:de},{default:i((()=>[n(O,{type:"selection",width:"55"}),n(O,{type:"index"}),n(O,{prop:"Name",label:"节点名",sortable:""},{default:i((({row:e})=>[n(K,{effect:"plain"},{default:i((()=>[m(f(e.Name),1)])),_:2},1024)])),_:1}),n(O,{prop:"Link",label:"链接","show-overflow-tooltip":!0},{default:i((({row:e})=>[n(K,{effect:"plain",type:"success"},{default:i((()=>[m(f(e.Link),1)])),_:2},1024)])),_:1}),n(O,{prop:"CreatedAt",label:"创建时间",formatter:te,sortable:"","show-overflow-tooltip":""}),n(O,{label:"所属分组",formatter:oe,"show-overflow-tooltip":""}),n(O,{label:"操作",width:"120"},{default:i((e=>[n(T,{link:"",type:"primary",size:"small",onClick:a=>{return l=e.row,z.value="edit",J.value=!0,P.value={ID:l.ID,Title:"编辑节点",Name:l.Name,Link:l.Link,GroupName:(l.GroupNodes||[]).map((e=>e.Name))},M.value=P.value.GroupName||[],void(Q.value=l.Name);var l}},{default:i((()=>a[14]||(a[14]=[m("编辑")]))),_:2,__:[14]},1032,["onClick"]),n(T,{link:"",type:"primary",size:"small",onClick:a=>{return l=e.row,void ue(l.Link);var l}},{default:i((()=>a[15]||(a[15]=[m("复制")]))),_:2,__:[15]},1032,["onClick"]),n(T,{link:"",type:"primary",size:"small",onClick:a=>(async e=>{try{await k.confirm(`你是否要删除 ${e.Name} ?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await U({id:e.ID}),_.success("删除成功")}catch(a){"cancel"!==a&&_.error("删除失败！")}await ee(),await Z(),Y()})(e.row)},{default:i((()=>a[16]||(a[16]=[m("删除")]))),_:2,__:[16]},1032,["onClick"])])),_:1})])),_:1},8,["data"]),a[22]||(a[22]=y("div",{style:{"margin-top":"20px"}},null,-1)),n(T,{type:"info",onClick:ie},{default:i((()=>a[17]||(a[17]=[m("全选")]))),_:1,__:[17]}),n(T,{type:"warning",onClick:re},{default:i((()=>a[18]||(a[18]=[m("取消选中")]))),_:1,__:[18]}),n(T,{type:"primary",onClick:se},{default:i((()=>a[19]||(a[19]=[m("复制选中")]))),_:1,__:[19]}),n(T,{type:"danger",onClick:ne},{default:i((()=>a[20]||(a[20]=[m("删除选中")]))),_:1,__:[20]}),a[23]||(a[23]=y("div",{style:{"margin-top":"20px"}},null,-1))])),_:1,__:[21,22,23]})])}}});export{z as default};
